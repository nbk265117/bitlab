## BetLab Sports Betting Platform

Production-ready Laravel 11 application for operating a sports betting platform with user onboarding, betting slips, deposits/withdrawals, and an admin dashboard. This repository includes a full Docker setup for local development.

### Status
![PHP](https://img.shields.io/badge/PHP-8.3-blue)
![Laravel](https://img.shields.io/badge/Laravel-11-red)
![License](https://img.shields.io/badge/License-Proprietary-lightgrey)

### Features
- User auth, KYC checks, password reset
- Admin dashboard for events, markets, outcomes, gateways, and reports
- Multiple payment gateways (cards, crypto, wallets) via configurable drivers
- Notifications via email, SMS, and push
- REST endpoints for deposits (IPN routes) and webhooks

### Tech Stack
- PHP 8.3, Laravel 11
- MySQL 8
- Nginx (Docker)

---

## Quick Start (Docker)

Prerequisites:
- Docker Desktop (or Docker Engine) and Docker Compose

Steps:
1) Clone the repo
```bash
git clone https://github.com/nbk265117/bitlab.git
cd bitlab
```

2) Start containers
```bash
docker compose up -d --build
```

3) Seed environment and app key (first time only)
```bash
docker exec -it betlab-app bash -lc 'cd core && [ -f .env ] || cp .env.example .env || true && php artisan key:generate && php artisan optimize:clear'
```

4) Run migrations (and optionally seed)
```bash
docker exec -it betlab-app bash -lc 'cd core && php artisan migrate --force'
# Optional: php artisan db:seed
```

5) Open the app
- Frontend: `http://localhost`
- Admin: `http://localhost/admin`

If you see a maintenance page, ensure the database is set up and caches are cleared:
```bash
docker exec -it betlab-app bash -lc 'cd core && php artisan optimize:clear'
```

---

## Manual Setup (without Docker)

Prerequisites:
- PHP 8.3 with extensions: BCMath, Ctype, Fileinfo, JSON, Mbstring, OpenSSL, PDO, Tokenizer, XML, cURL, GD
- Composer
- MySQL 8 (or compatible)

Steps:
1) Copy env and set credentials
```bash
cd core
cp .env.example .env
# Edit .env and set DB_* values
```

2) Install dependencies
```bash
composer install --no-interaction --prefer-dist
```

3) Generate app key and migrate
```bash
php artisan key:generate
php artisan migrate --force
php artisan optimize:clear
```

4) Serve (dev only)
```bash
php artisan serve --host=0.0.0.0 --port=8000
# Open http://127.0.0.1:8000
```

Permissions (Linux/macOS):
```bash
chmod -R ug+rw core/storage core/bootstrap/cache
```

---

## Configuration
- App settings are stored in `core/.env` and `core/config/*`.
- Payment gateways can be configured in the admin panel and via database records.
- Queue: set `QUEUE_CONNECTION=database` and run a worker in production.

### Environment variables (core/.env)

| Key | Example | Notes |
|-----|---------|-------|
| APP_NAME | BetLab | |
| APP_ENV | local | production for prod |
| APP_KEY | base64:… | generated by artisan |
| APP_DEBUG | true | false for prod |
| APP_URL | http://localhost | public base URL |
| LOG_CHANNEL | stack | |
| DB_CONNECTION | mysql | |
| DB_HOST | db | docker service name or host |
| DB_PORT | 3306 | |
| DB_DATABASE | betlab | |
| DB_USERNAME | betlab | |
| DB_PASSWORD | betlab | |
| CACHE_STORE | file | redis in prod recommended |
| SESSION_DRIVER | file | redis in prod recommended |
| QUEUE_CONNECTION | sync | database/redis in prod |

---

## Useful Commands
```bash
# Inside the PHP container
docker exec -it betlab-app bash

# Clear and rebuild caches
php core/artisan optimize:clear

# Run migrations
php core/artisan migrate --force

# Tail Laravel log
docker exec -it betlab-app bash -lc 'tail -f core/storage/logs/laravel.log'
```

---

## Troubleshooting
- MissingAppKeyException: run `php artisan key:generate` (or the docker exec variant above).
- Database connection errors: verify `DB_*` in `core/.env` matches Docker compose (host `db`, user `betlab`, password `betlab`).
- Stale redirects or views: run `php artisan optimize:clear`.

---

## Security Notice
Do not commit secrets to the repository. Configure API keys and credentials via environment variables (`core/.env`) and the admin panel.

---

## Admin Access
If no admin user exists after migration, you can create one quickly.

Docker:
```bash
docker exec -it betlab-app bash -lc "php core/artisan tinker --execute=\"\\App\\Models\\Admin::create(['username'=>'admin','email'=>'admin@example.com','password'=>bcrypt('admin123')]);\""
```

Local (without Docker):
```bash
php core/artisan tinker --execute="\\App\\Models\\Admin::create(['username'=>'admin','email'=>'admin@example.com','password'=>bcrypt('admin123')]);"
```

Then login at `http://localhost/admin`.

---

## How to Start

Starting with BetLab is quick and straightforward. Whether you're launching a new sports betting platform or upgrading an existing one, follow these simple steps to get up and running:

### General Settings & System Configuration
- Set platform details like title, currency, timezone, and base color under General Settings in the System Settings menu.
- Control key features such as Bettor Registration, Force SSL, KYC Verification, Email/Mobile Verification, and the Referral Program under System Configuration in the System Settings menu.

### Configure API Settings (Optional)
- If you want to automate the process of fetching sports data, configure the API integration in the API Setting under System Settings menu.
- Choose whether to use automatic API data fetching for categories, leagues, games, markets, and odds, or add them manually.

### Set Up Cron Jobs
Configure the following cron jobs under the System Settings to automate key tasks:
- Fetch Leagues: Fetches leagues, tournaments, and competitions from the API and updates the database.
- Fetch Games (Optional): Fetches games from the API and updates the database. If you want to manually add odds but fetch games from the API, set up this cron job. Games can also be fetched when updating odds.
- Fetch Odds: Fetches all odds, including live odds, from the API and updates the database.
- Fetch In-Play Odds: Fetches in-play odds from the API and updates the database.
- Enable Games to Bet: Automatically updates games from "Not Open for Betting" to "Open for Betting" once the game start time is reached.
- Process Winning Bets: Updates users' balances by adding the return amount for winning bets and sends a notification.
- Manage Losing Bets: Notifies users about their losing bets.
- Manage Refundable Bets: Refunds the stake amount by adding it back to the user’s balance and sends a notification.

### Configure Sports
- Add sports categories, tournaments, leagues, teams, and games to your platform.
- Set up betting markets and odds either automatically via the API or manually.

### Add Games, Markets & Odds
- Add sports categories, tournaments, leagues, teams, and games to your platform.
- Set up betting markets and odds either automatically via the API or manually.

### Add Payment Gateways & Withdrawal Methods
- Configure over 30+ payment gateways and set up custom withdrawal methods under the System Settings to facilitate secure user transactions.

### Configure Notification Settings
- Set up push, SMS, and email notifications to keep users engaged with timely updates about their bets, odds, and results.

### Customize Frontend Contents
- Personalize your platform’s frontend, including your logo, favicon, and custom CSS to align with your brand. Configure policy pages, social logins, and extensions like Custom Captcha, Google Recaptcha, Google Analytics, Facebook Comment, and Tawk.to—all within the System Settings.

### Test and Launch
- Conduct thorough testing to ensure everything works smoothly.
- Once satisfied, launch your platform to start accepting bets and engaging users!


